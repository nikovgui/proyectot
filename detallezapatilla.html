<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalles de la Zapatilla</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f8f8f8; }
        .navbar { background: white; padding: 15px 20px; border-bottom: 1px solid #ddd; }
        .navbar-brand { font-weight: bold; font-size: 1.5rem; }
        .container { max-width: 1100px; margin: auto; display: flex; gap: 40px; padding: 40px; background: white; 
                     box-shadow: 0 0 10px rgba(0,0,0,0.1); border-radius: 10px; margin-top: 30px; }
        .gallery { display: flex; flex-direction: column; gap: 10px; }
        .thumbnail { width: 70px; height: 70px; cursor: pointer; border: 1px solid #ddd; padding: 5px; border-radius: 5px; }
        .thumbnail img { width: 100%; height: 100%; object-fit: cover; border-radius: 5px; }
        .main-image { width: 100%; max-width: 450px; border-radius: 10px; }
        .product-info { flex: 1; padding: 10px; }
        .product-name { font-size: 1.8rem; font-weight: bold; margin-bottom: 10px; }
        .product-price { font-size: 1.5rem; color: #333; font-weight: bold; margin-bottom: 20px; }
        .size-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .size-button { padding: 10px 15px; border: 1px solid #000; cursor: pointer; background: white; font-weight: bold; border-radius: 5px; }
        .size-button.selected { background: black; color: white; }
        .action-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .btn-main { background: black; color: white; padding: 12px 20px; border-radius: 5px; font-size: 1rem; cursor: pointer; border: none; width: 100%; }
        .btn-secondary { background: white; color: black; border: 1px solid black; padding: 12px 20px; border-radius: 5px; font-size: 1rem; cursor: pointer; width: 100%; }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="container-fluid">
            <a class="navbar-brand" href="home.html">OGKicks</a>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="container">
        <div class="gallery" id="image-gallery"></div>
        <div>
            <img id="main-image" class="main-image" src="" alt="Zapatilla">
        </div>
        <div class="product-info">
            <h1 id="sneaker-name" class="product-name"></h1>
            <p class="product-price">Precio: <span id="final-price">-</span></p>

            <p><strong>Selecciona tu talla:</strong></p>
            <div class="size-container" id="size-options"></div>

            <div class="action-buttons">
                <button id="comprar-btn" class="btn-main" disabled>Comprar Ahora</button>
                <button id="agregarCarrito" class="btn-secondary">AÃ±adir al carrito</button>           
            </div>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const sneakerId = params.get("id");
        let selectedSize = null;

        fetch(`http://localhost/sneaker_store/get_sneakers.php?id=${sneakerId}`)
            .then(response => response.json())
            .then(sneaker => {
                console.log("Datos recibidos:", sneaker);

                if (!sneaker || sneaker.error || !sneaker.sizes) {
                    console.error("Error en la API:", sneaker.error);
                    document.body.innerHTML = "<h2>Error: No se pudo cargar la zapatilla.</h2>";
                    return;
                }

                document.getElementById("sneaker-name").textContent = sneaker.name;
                document.getElementById("main-image").src = sneaker.images[0];

                const imageGallery = document.getElementById("image-gallery");
                sneaker.images.forEach(imgSrc => {
                    const div = document.createElement("div");
                    div.classList.add("thumbnail");
                    div.innerHTML = `<img src="${imgSrc}" alt="Vista de zapatilla">`;
                    div.onclick = () => {
                        document.getElementById("main-image").src = imgSrc;
                    };
                    imageGallery.appendChild(div);
                });

                const sizeContainer = document.getElementById("size-options");
                const sizes = Array.isArray(sneaker.sizes) ? sneaker.sizes : JSON.parse(sneaker.sizes);

                sizes.forEach(size => {
                    const button = document.createElement("button");
                    button.classList.add("size-button");
                    button.textContent = `US ${size}`;

                    button.onclick = () => {
                        document.querySelectorAll(".size-button").forEach(btn => btn.classList.remove("selected"));
                        button.classList.add("selected");
                        selectedSize = size;
                        document.getElementById("final-price").textContent = `$${sneaker.prices[size]}`;
                        document.getElementById("comprar-btn").disabled = false;
                    };

                    sizeContainer.appendChild(button);
                });

                // ðŸ“Œ **Corrige la lÃ³gica para comprar y agregar al carrito**
                document.getElementById("comprar-btn").addEventListener("click", function() {
                    if (!selectedSize) {
                        alert("Por favor, selecciona una talla antes de comprar.");
                        return;
                    }

                    const sneakerPrice = document.getElementById("final-price").textContent.replace("$", "");

                    window.location.href = `http://localhost/sneaker_store/formulario_pago.html?id=${sneakerId}&precio=${sneakerPrice}&size=${selectedSize}`;
                });

                document.getElementById("agregarCarrito").addEventListener("click", function () {
                    if (!selectedSize) {
                        alert("Selecciona una talla antes de aÃ±adir al carrito.");
                        return;
                    }

                    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];
                    carrito.push({
                        id: sneakerId,
                        name: document.getElementById("sneaker-name").textContent,
                        image: document.getElementById("main-image").src,
                        size: selectedSize,
                        price: document.getElementById("final-price").textContent.replace("$", "")
                    });

                    localStorage.setItem("carrito", JSON.stringify(carrito));
                    alert("âœ… Producto aÃ±adido al carrito!");
                });

            })
            .catch(error => console.error("Error obteniendo detalles:", error));
    </script>

</body>
</html>
